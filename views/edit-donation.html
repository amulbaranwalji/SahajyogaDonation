<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Donation</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">

<style>
.card-custom {
  border-radius: 18px;
}
.form-control:focus {
  border-color: #198754;
  box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25);
}
  .btn-primary {
  background-color: #F32B56;
  border: none;
}
.btn-primary:hover {
  background-color: #d92148;
}
</style>
</head>

<body class="d-flex flex-column min-vh-100 bg-light">

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
  <a class="navbar-brand d-flex align-items-center" href="/dashboard">
    <img src="/images/logo.png" width="40" height="40" class="me-2">
    Donor App
  </a>

  <div class="ms-auto dropdown">
    <a class="text-white dropdown-toggle text-decoration-none"
       href="#" data-bs-toggle="dropdown">Welcome</a>
    <ul class="dropdown-menu dropdown-menu-end">
      <li><a class="dropdown-item" href="/profile-page">View Profile</a></li>
      <li><hr class="dropdown-divider"></li>
      <li><a class="dropdown-item text-danger" href="/logout">Logout</a></li>
    </ul>
  </div>
</nav>

<!-- TABS -->
<div class="bg-white shadow-sm">
  <div class="container">
    <ul class="nav nav-tabs py-2 flex-nowrap overflow-auto">
      <li class="nav-item"><a class="nav-link" href="/dashboard">Dashboard</a></li>
      <li class="nav-item"><a class="nav-link" href="/donors-page">Donors</a></li>
      <li class="nav-item"><a class="nav-link" href="/programs-page">Programs</a></li>
      <li class="nav-item"><a class="nav-link active" href="/donations-page">Donations</a></li>
      <li class="nav-item"><a class="nav-link" href="/expenses-page">Expenses</a></li>
    </ul>
  </div>
</div>

<main class="flex-fill">
<div class="container my-5">

<div class="card shadow-lg card-custom mx-auto" style="max-width:600px;">
<div class="card-header bg-dark text-white">
<h5 class="mb-0">Edit Donation</h5>
</div>

<div class="card-body">

<form id="editDonationForm" method="POST">

<!-- Receipt (Read Only) -->
<div class="mb-3">
<label class="form-label">Receipt Number</label>
<input type="text" id="receipt_number"
class="form-control" readonly>
</div>

<!-- Donor -->
<div class="mb-3">
<label class="form-label">Donor Name</label>
<input type="text" id="donor_name"
class="form-control" readonly>
</div>

<!-- Amount -->
<div class="mb-3">
<label class="form-label">Donation Amount</label>
<input type="number" name="donation_amount"
id="donation_amount"
class="form-control"
min="1"
required>
</div>

<!-- Date -->
<div class="mb-3">
<label class="form-label">Donation Date</label>
<input type="date" name="donation_date"
id="donation_date"
class="form-control"
required>
</div>

<!-- Program -->
<div class="mb-3">
<label class="form-label">Program</label>
<select name="program_id"
id="program_id"
class="form-select"
required>
<option value="">Select Program</option>
</select>
</div>

<!-- Payment Mode -->
<div class="mb-3">
<label class="form-label">Payment Mode</label>
<select name="payment_mode"
id="payment_mode"
class="form-select">
<option value="Cash">Cash</option>
<option value="NEFT">NEFT</option>
<option value="UPI">UPI</option>
</select>
</div>

<!-- Remarks -->
<div class="mb-3">
<label class="form-label">Remarks</label>
<textarea name="remarks"
id="remarks"
class="form-control"></textarea>
</div>

<div class="d-flex justify-content-between">
<button type="submit" class="btn btn-primary">Update Donation</button>
<a href="/donations-page" class="btn btn-secondary">Cancel</a>
</div>

</form>

</div>
</div>

</div>
</main>

<footer class="bg-dark text-white text-center py-3 mt-auto">
Â© 2026 Donor App | Powered By KREYA IT CONSULTING LTD | 9582388885
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>

/*
========================================
GET DONATION ID FROM URL
========================================
*/
const donationId = new URLSearchParams(window.location.search).get("id");

document.getElementById("editDonationForm").action =
`/donations/update/${donationId}`;


/*
========================================
LOAD PROGRAM DROPDOWN
========================================
*/
fetch('/programs-dropdown')
.then(res => res.json())
.then(programs => {

const dropdown = document.getElementById("program_id");

programs.forEach(p => {
const option = document.createElement("option");
option.value = p.id;
option.text = p.program_name;
dropdown.appendChild(option);
});

});


/*
========================================
LOAD DONATION DATA
========================================
*/
fetch(`/donations/${donationId}`)
.then(res => res.json())
.then(data => {

document.getElementById("receipt_number").value = data.receipt_number;
document.getElementById("donor_name").value =
data.first_name + " " + data.last_name;

document.getElementById("donation_amount").value = data.donation_amount;

document.getElementById("donation_date").value =
data.donation_date.split("T")[0];

document.getElementById("payment_mode").value = data.payment_mode;

document.getElementById("remarks").value = data.remarks || "";

setTimeout(() => {
document.getElementById("program_id").value = data.program_id;
}, 300);

})
.catch(err => {
console.error(err);
alert("Unable to load donation data.");
});

</script>

</body>
</html>
