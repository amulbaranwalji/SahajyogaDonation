<!DOCTYPE html>
<html>
<head>
<title>Edit Expense</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-light d-flex flex-column min-vh-100">

<nav class="navbar navbar-dark bg-dark px-4">
<a class="navbar-brand" href="/dashboard">Donor App</a>
</nav>

<main class="flex-fill">
<div class="container mt-5">

<div class="card shadow mx-auto" style="max-width:600px;">
<div class="card-header bg-dark text-white">
<h5>Edit Expense</h5>
</div>

<div class="card-body">

<form id="editExpenseForm" method="POST">

<input type="hidden" id="expense_id">

<div class="mb-3">
<label>Program</label>
<select name="program_id" id="programDropdown"
class="form-select" required>
</select>
</div>

<div class="mb-3">
<label>Amount</label>
<input type="number" name="expense_amount"
id="expense_amount"
class="form-control"
min="1"
required>
</div>

<div class="mb-3">
<label>Date</label>
<input type="date" name="expense_date"
id="expense_date"
class="form-control"
required>
</div>

<div class="mb-3">
<label>Status</label>
<input type="text" name="status"
id="status"
class="form-control">
</div>

<div class="mb-3">
<label>Submitted By</label>
<input type="text" name="submitted_by"
id="submitted_by"
class="form-control">
</div>

<div class="mb-3">
<label>Remarks</label>
<textarea name="remarks"
id="remarks"
class="form-control"></textarea>
</div>

<button class="btn btn-success w-100">
Update Expense
</button>

</form>

</div>
</div>

</div>
</main>

<script>
const params = new URLSearchParams(window.location.search);
const expenseId = params.get("id");

document.getElementById("editExpenseForm").action =
`/expenses/update/${expenseId}`;

// Load Programs
fetch('/programs-dropdown')
.then(res => res.json())
.then(data => {
const dropdown = document.getElementById("programDropdown");
data.forEach(p=>{
let option = document.createElement("option");
option.value = p.id;
option.text = p.program_name;
dropdown.appendChild(option);
});
});

// Load Expense Data
fetch(`/expenses/${expenseId}`)
.then(res => res.json())
.then(data => {

document.getElementById("programDropdown").value = data.program_id;
document.getElementById("expense_amount").value = data.expense_amount;
document.getElementById("expense_date").value =
data.expense_date.split('T')[0];
document.getElementById("status").value = data.status || "";
document.getElementById("submitted_by").value = data.submitted_by || "";
document.getElementById("remarks").value = data.remarks || "";

})
.catch(()=>{
alert("Unable to load expense data.");
});
</script>

</body>
</html>
