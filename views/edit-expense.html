<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Edit Expense</title>

<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
<link rel="stylesheet" href="/css/style.css">

<style>
.card-custom {
  border-radius: 16px;
}

  .btn-primary {
  background-color: #F32B56;
  border: none;
}
.btn-primary:hover {
  background-color: #d92148;
}
  
</style>
</head>

<body class="d-flex flex-column min-vh-100 bg-light">

<!-- ✅ NAVBAR (MATCHES SYSTEM) -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark px-4">
  <a class="navbar-brand d-flex align-items-center" href="/dashboard">
    <img src="/images/logo.png" width="40" height="40" class="me-2">
    Donor App
  </a>

  <div class="ms-auto dropdown">
    <a class="text-white dropdown-toggle text-decoration-none"
       href="#" data-bs-toggle="dropdown">
      Welcome
    </a>
    <ul class="dropdown-menu dropdown-menu-end">
      <li><a class="dropdown-item" href="/profile-page">View Profile</a></li>
      <li><hr class="dropdown-divider"></li>
      <li><a class="dropdown-item text-danger" href="/logout">Logout</a></li>
    </ul>
  </div>
</nav>

<!-- ✅ TOP TABS -->
<div class="bg-white shadow-sm">
  <div class="container">
    <ul class="nav nav-tabs py-2 flex-nowrap overflow-auto">
      <li class="nav-item"><a class="nav-link" href="/dashboard">Dashboard</a></li>
      <li class="nav-item"><a class="nav-link" href="/donors-page">Donors</a></li>
      <li class="nav-item"><a class="nav-link" href="/programs-page">Programs</a></li>
      <li class="nav-item"><a class="nav-link" href="/donations-page">Donations</a></li>
      <li class="nav-item"><a class="nav-link active" href="/expenses-page">Expenses</a></li>
    </ul>
  </div>
</div>

<main class="flex-fill">
<div class="container my-5">

<div class="card shadow-lg card-custom mx-auto" style="max-width:600px;">
<div class="card-header bg-dark text-white">
<h5 class="mb-0">Edit Expense</h5>
</div>

<div class="card-body">

<form id="editExpenseForm" method="POST">

<input type="hidden" id="expense_id">

<div class="mb-3">
<label class="form-label">Program</label>
<select name="program_id" id="programDropdown"
class="form-select" required>
<option value="">Select Program</option>
</select>
</div>

<div class="mb-3">
<label class="form-label">Expense Amount</label>
<input type="number"
name="expense_amount"
id="expense_amount"
class="form-control"
min="1"
required>
</div>

<div class="mb-3">
<label class="form-label">Expense Date</label>
<input type="date"
name="expense_date"
id="expense_date"
class="form-control"
required>
</div>

<div class="mb-3">
<label class="form-label">Status</label>
<input type="text"
name="status"
id="status"
class="form-control">
</div>

<div class="mb-3">
<label class="form-label">Submitted By</label>
<input type="text"
name="submitted_by"
id="submitted_by"
class="form-control">
</div>

<div class="mb-3">
<label class="form-label">Remarks</label>
<textarea name="remarks"
id="remarks"
class="form-control"></textarea>
</div>

<div class="d-flex justify-content-between">
<a href="/expenses-page" class="btn btn-secondary">
Cancel
</a>
<button type="submit" class="btn btn-primary">
Update Expense
</button>
</div>

</form>

</div>
</div>

</div>
</main>

<!-- ✅ FOOTER -->
<footer class="bg-dark text-white text-center py-3 mt-auto">
© 2026 Donor App | Powered By KREYA IT CONSULTING LTD | 9582388885 | All Rights Reserved.
</footer>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
// Get ID from query param
const params = new URLSearchParams(window.location.search);
const expenseId = params.get("id");

document.getElementById("editExpenseForm").action =
  `/expenses/update/${expenseId}`;

/* ================================
   LOAD PROGRAM DROPDOWN
================================ */
fetch('/programs-dropdown')
.then(res => res.json())
.then(data => {
  const dropdown = document.getElementById("programDropdown");

  data.forEach(p => {
    let option = document.createElement("option");
    option.value = p.id;
    option.text = p.program_name;
    dropdown.appendChild(option);
  });
});

/* ================================
   LOAD EXPENSE DATA
================================ */
fetch(`/expenses/${expenseId}`)
.then(res => res.json())
.then(data => {

  document.getElementById("programDropdown").value = data.program_id;
  document.getElementById("expense_amount").value = data.expense_amount;
  document.getElementById("expense_date").value =
    data.expense_date.split('T')[0];
  document.getElementById("status").value = data.status || "";
  document.getElementById("submitted_by").value = data.submitted_by || "";
  document.getElementById("remarks").value = data.remarks || "";

})
.catch(() => {
  alert("Unable to load expense data.");
});
</script>

</body>
</html>
